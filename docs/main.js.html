<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>main.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Events</li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="global.html#event:KeyDown">KeyDown</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkCollision">checkCollision</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkFoodCollision">checkFoodCollision</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkWallCollision">checkWallCollision</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#draw">draw</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#drawFood">drawFood</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#drawScore">drawScore</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#drawSnake">drawSnake</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#drawTimer">drawTimer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#endGame">endGame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateFood">generateFood</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleDirectionChange">handleDirectionChange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#initSnake">initSnake</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#loadConfig">loadConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mainMenu">mainMenu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#moveSnake">moveSnake</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#pauseGame">pauseGame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resumeGame">resumeGame</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#startGame">startGame</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">main.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { initSnake, moveSnake, drawSnake } from "./snake.js";
import { generateFood, drawFood } from "./food.js";
import { handleDirectionChange } from "./controls.js";
import { checkCollision, checkWallCollision } from "./collision.js";
import { drawScore } from "./score.js";
import { checkFoodCollision } from "./collision.js";
import { drawTimer } from "./score.js";

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let config;
let box;
let gameSpeed;
let snake;
let food;
let direction
let score;
let gameInterval; // Variable pour stocker l'identifiant de l'intervalle
let startTime
let isPaused = false;
let pausedTime = 0;
let pauseStart = 0;

/**
 * Gère les événements de changement de direction du serpent.
 * @event KeyDown
 * @param {KeyboardEvent} event - L'événement de clavier déclenché lors de l'appui sur une touche.
 * @param {string} direction - La direction actuelle du serpent.
 */
document.addEventListener("keydown", (event) => {
  direction = handleDirectionChange(event, direction);
});

/**
 * Affiche le menu principal du jeu.
 * 
 * Cette fonction dessine l'écran du menu principal sur le canvas, invitant le joueur à appuyer sur la touche "Entrée" pour commencer le jeu.
 * Elle écoute également les événements de clavier pour détecter l'appui sur la touche "Entrée"
 * et démarre le jeu en appelant la fonction `startGame`.
 */
function mainMenu() {
  ctx.fillStyle = config.colors.background;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "black";
  ctx.font = "30px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Press Enter to Start", canvas.width / 2, canvas.height / 2);
  document.addEventListener("keydown", (event) => {
    if (event.code === config.keys.start) {
      clearInterval(gameInterval);
      score = 0
      startGame();
    }
  });
}

/**
 * Démarre une nouvelle partie du jeu.
 * 
 * Cette fonction initialise le serpent, génère la nourriture, et lance la boucle de jeu
 * en utilisant `setInterval` pour appeler la fonction `draw` à intervalles réguliers
 * définis par `gameSpeed`. Elle enregistre également le temps de début du jeu pour le suivi du temps.
 */
function startGame() {
  snake = initSnake();
  food = generateFood(box, canvas);
  gameInterval = setInterval(draw, gameSpeed); // Stockage de l'identifiant de l'intervalle
  startTime = Date.now(); // Temps de début du jeu
}

/**
 * Affiche l'écran de fin de jeu.
 * 
 * Cette fonction dessine l'écran de fin de jeu sur le canvas, affichant le message "Game Over !",
 * le score final du joueur, et le temps écoulé pendant la partie.
 */
function endGame() {
  ctx.fillStyle = "lightgrey";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "black";
  ctx.font = "30px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Game Over !", canvas.width / 2, canvas.height / 2 - 50);
  ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2 -10);
  ctx.fillText(`Time: ${Math.floor((Date.now() - startTime - pausedTime) / 1000)} seconds`, canvas.width / 2, canvas.height / 2 +30);
}

/**
 * Met en pause le jeu.
 * 
 * Cette fonction arrête l'intervalle de jeu, enregistre le temps de début de la pause,
 * et affiche un écran de pause sur le canvas.
 */
function pauseGame() {
  if (gameInterval) {
    clearInterval(gameInterval);
    pauseStart = Date.now();
    isPaused = true;
    ctx.fillStyle = config.colors.pauseOverlay;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "40px Arial";
    ctx.fillText("PAUSE", canvas.width / 2 - 70, canvas.height / 2);
  }
}

/**
 * Reprend le jeu après une pause.
 * 
 * Cette fonction redémarre la boucle de jeu et ajuste le temps de pause pour un calcul correct du timer.
 */
function resumeGame() {
  if (isPaused) {
    pausedTime += Date.now() - pauseStart;
    gameInterval = setInterval(draw, gameSpeed);
    isPaused = false;
  }
}

/**
 * Gère les événements de pause et de reprise du jeu.
 * @event KeyDown
 * @param {KeyboardEvent} event - L'événement de clavier déclenché lors de l'appui sur une touche.
 */
document.addEventListener("keydown", (event) => {
  if (event.code === config.keys.pause) {
    if (!isPaused) {
      pauseGame();
    } else {
      resumeGame();
    }
  }
});

/**
 * Boucle principale du jeu : met à jour et redessine tous les éléments à chaque frame.
 */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  snake = moveSnake(snake, direction, box);
  drawSnake(ctx, snake, box);
  drawFood(ctx, food, box);

  if (checkCollision(snake[0], snake) || checkWallCollision(snake[0], canvas, box)) {
    clearInterval(gameInterval);
    endGame();
  }

  if (checkFoodCollision(snake[0], food)) {
    score += 1;
    food = generateFood(box, canvas);
    snake.push({}); // Ajoute un segment au serpent en ne supprimant pas le dernier segment
  }

  drawScore(ctx, score);
  drawTimer(ctx, Math.floor((Date.now() - startTime - pausedTime) / 1000));
}

/**
 * Charge la configuration du jeu à partir d'un fichier JSON et initialise les paramètres du jeu.
 * 
 * @async
 * @returns {Promise&lt;void>} - Une promesse qui se résout lorsque la configuration est chargée et le menu principal affiché.
 */
async function loadConfig() {
  try {
    const response = await fetch("./config.json");
    config = await response.json();

    box = config.box;
    gameSpeed = config.gameSpeed;
    direction = config.initialDirection;
    score = config.startingScore;

    // Taille du canvas
    canvas.width = config.canvasWidth;
    canvas.height = config.canvasHeight;

    console.log("Configuration chargée :", config);
    mainMenu();
  } catch (error) {
    console.error("Erreur lors du chargement de la configuration :", error);
  }
}

loadConfig();</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Wed Oct 29 2025 15:35:44 GMT+0100 (heure normale d’Europe centrale) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
